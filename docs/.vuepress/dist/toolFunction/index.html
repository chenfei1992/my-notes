<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Flow | 笔记</title>
    <meta name="generator" content="VuePress 1.5.3">
    
    <meta name="description" content="Just playing around">
    <link rel="preload" href="/assets/css/0.styles.ae3ca5a1.css" as="style"><link rel="preload" href="/assets/js/app.a8c572bd.js" as="script"><link rel="preload" href="/assets/js/2.8ad555b3.js" as="script"><link rel="preload" href="/assets/js/23.591b0146.js" as="script"><link rel="prefetch" href="/assets/js/10.bc8c9edd.js"><link rel="prefetch" href="/assets/js/11.7852df2d.js"><link rel="prefetch" href="/assets/js/12.0276bf0e.js"><link rel="prefetch" href="/assets/js/13.9c10a216.js"><link rel="prefetch" href="/assets/js/14.503326b3.js"><link rel="prefetch" href="/assets/js/15.22fe533e.js"><link rel="prefetch" href="/assets/js/16.6d9e0de2.js"><link rel="prefetch" href="/assets/js/17.b8e4bc72.js"><link rel="prefetch" href="/assets/js/18.7b96dcc6.js"><link rel="prefetch" href="/assets/js/19.f3594601.js"><link rel="prefetch" href="/assets/js/20.04d41889.js"><link rel="prefetch" href="/assets/js/21.e793a45c.js"><link rel="prefetch" href="/assets/js/22.711072f1.js"><link rel="prefetch" href="/assets/js/24.1c76ecbe.js"><link rel="prefetch" href="/assets/js/25.6505bbef.js"><link rel="prefetch" href="/assets/js/26.f12e41a0.js"><link rel="prefetch" href="/assets/js/27.342ea004.js"><link rel="prefetch" href="/assets/js/28.b40cd87f.js"><link rel="prefetch" href="/assets/js/29.a6069e4d.js"><link rel="prefetch" href="/assets/js/3.d45b3a70.js"><link rel="prefetch" href="/assets/js/30.80f23c0e.js"><link rel="prefetch" href="/assets/js/31.2dbac603.js"><link rel="prefetch" href="/assets/js/4.a4ca32bb.js"><link rel="prefetch" href="/assets/js/5.39ac0b6f.js"><link rel="prefetch" href="/assets/js/6.0d5dae60.js"><link rel="prefetch" href="/assets/js/7.b3bd3833.js"><link rel="prefetch" href="/assets/js/8.97041da4.js"><link rel="prefetch" href="/assets/js/9.8d55680f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ae3ca5a1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/demoPages/" class="nav-link">
  Demo
</a></div><div class="nav-item"><a href="/tools/" class="nav-link">
  工具库
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/demoPages/" class="nav-link">
  Demo
</a></div><div class="nav-item"><a href="/tools/" class="nav-link">
  工具库
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">随录</a></li><li><a href="/VirtualDom/" class="sidebar-link">虚拟DOM</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>VUE</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>小程序</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>REACT</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>档案</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/packages/" class="sidebar-link">原生封装</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>原理分析</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/h5Development/" class="sidebar-link">H5 开发技巧</a></li><li><a href="/cssModule/" class="sidebar-link">CSS 文档</a></li><li><a href="/javascript/" class="sidebar-link">javascript</a></li><li><a href="/typeScript/" class="sidebar-link">typeScript</a></li><li><a href="/ASM/" class="sidebar-link">ASM.js</a></li><li><a href="/%E9%9D%A2%E8%AF%95/" class="sidebar-link">面试</a></li><li><a href="/indexedDB/" class="sidebar-link">indexedDB</a></li><li><a href="/toolFunction/" aria-current="page" class="active sidebar-link">toolFunction</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/toolFunction/#flow" class="sidebar-link">Flow</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>构建工具</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/http/" class="sidebar-link">HTTP</a></li><li><a href="/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" class="sidebar-link">性能优化</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="flow">Flow</h2> <h3 id="maybe-types-判断类型">Maybe types(判断类型)</h3> <p>在前面加一个问号创建类型:    ?string?number
除了判断的类型之外，也可以是null 或者 void（undefined）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">acceptsMaybeString</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> <span class="token operator">?</span>string</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token function">acceptsMaybeString</span><span class="token punctuation">(</span><span class="token string">'bae'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// works</span>
<span class="token function">acceptsMaybeString</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// works</span>
<span class="token function">acceptsMaybeString</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// works</span>
<span class="token function">acceptsMaybeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// works</span>
</code></pre></div><h3 id="可选对象属性">可选对象属性</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">acceptsObject</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> <span class="token punctuation">{</span>foo<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token function">acceptsObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// Works!</span>
<span class="token function">acceptsObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token keyword">undefined</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Works!</span>
<span class="token function">acceptsObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// Error!</span>
<span class="token function">acceptsObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">// Works!</span>
</code></pre></div><h3 id="可选函数参数">可选函数参数</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">acceptsOptionalString</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">?</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token function">acceptsOptionalString</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token function">acceptsOptionalString</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// works</span>
<span class="token function">acceptsOptionalString</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// error</span>
<span class="token function">acceptsOptionalString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
</code></pre></div><h3 id="具有默认值的函数参数">具有默认值的函数参数</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">acceptsOptionalString</span><span class="token punctuation">(</span>value<span class="token operator">:</span> string <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token function">acceptsOptionalString</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token function">acceptsOptionalString</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// works</span>
<span class="token function">acceptsOptionalString</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Error</span>
<span class="token function">acceptsOptionalString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// works</span>
</code></pre></div><h3 id="literal-types（绝对类型）">Literal Types（绝对类型）</h3> <p>flow不仅可以使用原始类型，还可以使用值作为类型注释</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">acceptsTwo</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> <span class="token number">2</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token function">acceptsTwo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// works</span>
<span class="token comment">// $ExpectError</span>
<span class="token function">acceptsTwo</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Error</span>
<span class="token comment">// $ExpectError</span>
<span class="token function">acceptsTwo</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Error</span>
</code></pre></div><p>多个值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">getColor</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token string">'success'</span> <span class="token operator">|</span> <span class="token string">'warning'</span> <span class="token operator">|</span> <span class="token string">'danger'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">switch</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'success'</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">'green'</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'warning'</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">'yellow'</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'danger'</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">'red'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">getColor</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// works</span>
<span class="token function">getColor</span><span class="token punctuation">(</span><span class="token string">'danger'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token comment">// $ExpectError</span>
<span class="token function">getColor</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Error</span>
</code></pre></div><h3 id="mixed-types-混合型">Mixed Types(混合型)</h3> <p>单一类型</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">square</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token operator">:</span> number</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> n <span class="token operator">*</span> n
<span class="token punctuation">}</span>
</code></pre></div><p>多种类型</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">stringifyBasicValue</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> string <span class="token operator">|</span> number</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">''</span> <span class="token operator">+</span> value
<span class="token punctuation">}</span>
</code></pre></div><p>基于另一种类型的类型
返回值的类型与传入函数中的值的类型相同</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> identity<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>以上三种比较常用的类型</p> <h3 id="任意类型即混合型">任意类型即混合型</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getTypeOf</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> mixed</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">typeof</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="进得去出不来">进得去出不来</h3> <p>混合类型将接受所有的值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//@flow</span>
<span class="token keyword">function</span> <span class="token function">stringify</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> mixed</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">stringify</span><span class="token punctuation">(</span><span class="token number">3.14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当你尝试使用一个混合类型的值时，你必须首先弄清楚实际的类型是什么，否则将以错误告终。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span>  <span class="token function">stringify</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> mixed</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// $ExpectError</span>
  <span class="token keyword">return</span> <span class="token string">''</span> <span class="token operator">+</span> value<span class="token punctuation">;</span>  <span class="token comment">// Error</span>
<span class="token punctuation">}</span>
<span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>你必须来判断他是哪种值，代码才能运行</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">stringify</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> mixed</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">''</span><span class="token operator">+</span>value<span class="token punctuation">;</span>   <span class="token comment">// works</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">''</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="any-types-任何类型">Any Types(任何类型)</h3> <p>如何你想要一种不进行类型检测的方法。可以使用任何类型，但是要尽量避免使用，这是完全不安全的。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">one<span class="token operator">:</span> any<span class="token punctuation">,</span>two<span class="token operator">:</span> any</span><span class="token punctuation">)</span><span class="token operator">:</span> number <span class="token punctuation">{</span>
  <span class="token keyword">return</span> one <span class="token operator">+</span> two<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// works</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
</code></pre></div><p>即使导致运行错误的代码也不会被捕获：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">getNestedProperty</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token operator">:</span> any</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> obj<span class="token punctuation">.</span>foo<span class="token punctuation">.</span>bar<span class="token punctuation">.</span>baz
<span class="token punctuation">}</span>
<span class="token function">getNestedProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>只有几种情况可以考虑使用：</p> <ul><li>当您正在将现有代码转换为使用流类型的过程中，并且您当前在检查代码类型时被阻塞(可能需要首先转换其他代码)。</li> <li>当您确定您的代码正常工作时，由于某种原因，Flow无法输入，请对其进行正确的检查。在JavaScript中，有越来越多的习惯用法无法静态地输入。</li></ul> <h3 id="avoid-leaking-any">Avoid leaking any</h3> <p>当你有一个类型为Any的值时，你可以使用Flow推断出你执行的所有操作的结果是any。
如果你在输入ANY的对象上获得了一个属性，那么得到的值也将具有any类型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token operator">:</span> any</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> foo <span class="token comment">/*(:any)*/</span> <span class="token operator">=</span> obj<span class="token punctuation">.</span>foo
<span class="token punctuation">}</span>
</code></pre></div><p>然后，您可以在另一个操作中使用结果值，例如将其添加为一个数字，结果也将是any。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> foo <span class="token comment">/* (:any) */</span> <span class="token operator">=</span> obj<span class="token punctuation">.</span>foo<span class="token punctuation">;</span>
  <span class="token keyword">let</span> bar <span class="token comment">/* (:any) */</span> <span class="token operator">=</span> foo <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后把any暴露出去</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token comment">/* (:any) */</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> foo <span class="token comment">/* (:any) */</span> <span class="token operator">=</span> obj<span class="token punctuation">.</span>foo<span class="token punctuation">;</span>
  <span class="token keyword">let</span> bar <span class="token comment">/* (:any) */</span> <span class="token operator">=</span> foo <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> bar<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> bar <span class="token comment">/* (:any) */</span> <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> baz <span class="token comment">/* (:any) */</span> <span class="token operator">=</span> <span class="token string">&quot;baz:&quot;</span> <span class="token operator">+</span> bar<span class="token punctuation">;</span>
</code></pre></div><p>为了防止any类型暴露出去，我们可以如下做法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> foo<span class="token operator">:</span> number <span class="token operator">=</span> obj<span class="token punctuation">.</span>foo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样子的话，代码就不会把any类型暴露了，因为已经有个number类型接收。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token comment">/* (:number) */</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> foo<span class="token operator">:</span> number <span class="token operator">=</span> obj<span class="token punctuation">.</span>foo<span class="token punctuation">;</span>
  <span class="token keyword">let</span> bar <span class="token comment">/* (:number) */</span> <span class="token operator">=</span> foo <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> bar<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> bar <span class="token comment">/* (:number) */</span> <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> baz <span class="token comment">/* (:string) */</span> <span class="token operator">=</span> <span class="token string">&quot;baz:&quot;</span> <span class="token operator">+</span> bar<span class="token punctuation">;</span>
</code></pre></div><h3 id="maybe-types-我称他为判断类型">Maybe Types(我称他为判断类型)</h3> <p>如果你想使用一个非number类型的参数，可以如下定义，当然判断类型是可以接受null和undefined参数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">acceptsMaybeNumber</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> <span class="token operator">?</span>number</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token function">acceptsMaybeNumber</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// works</span>
<span class="token function">acceptsMaybeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// works</span>
<span class="token function">acceptsMaybeNumber</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token comment">// works</span>
<span class="token function">acceptsMaybeNumber</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// works</span>
<span class="token function">acceptsMaybeNumber</span><span class="token punctuation">(</span><span class="token string">'42'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Error</span>
</code></pre></div><h3 id="maybe-types进阶">Maybe Types进阶</h3> <p>假设我们有个Maybe Types?number，如果我们想使用该值作为一个数字，我们需要首先检查它是不是null或undefined</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">acceptsMaybeNumber</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> <span class="token operator">?</span>number</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> value <span class="token operator">*</span> <span class="token number">2</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="variable-types">Variable Types</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">const</span> foo <span class="token comment">/*:number*/</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bar<span class="token operator">:</span> number <span class="token operator">=</span> <span class="token number">2</span>
</code></pre></div><p>当你给变量声明类型的时候，你如果将它重新赋值，必须和他声明的值是一样的。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">let</span> foo<span class="token operator">:</span> number <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
foo <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token comment">// works</span>
<span class="token comment">// $ExpectError</span>
foo <span class="token operator">=</span> <span class="token string">'3'</span><span class="token punctuation">;</span>  <span class="token comment">// Error</span>
</code></pre></div><h3 id="reassigning-variables-重新分配变量">Reassigning variables(重新分配变量)</h3> <p>默认情况下，当你重新分配一个变量时，Flow将为它提供所有可能的赋值类型</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> foo <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> foo <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> foo <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> isOneOf<span class="token operator">:</span> number <span class="token operator">|</span> boolean <span class="token operator">|</span> string <span class="token operator">=</span> foo<span class="token punctuation">;</span>  <span class="token comment">// works</span>
</code></pre></div><p>有时，在重新分配后，flow能够(肯定地)找出变量的类型。在这种情况下，Flow将给出已知的类型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">let</span> foo <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> isNumber<span class="token operator">:</span> number <span class="token operator">=</span> foo<span class="token punctuation">;</span>  <span class="token comment">// works</span>
foo <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> isBoolean<span class="token operator">:</span> boolean <span class="token operator">=</span> foo<span class="token punctuation">;</span> <span class="token comment">// works</span>
foo <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> isString<span class="token operator">:</span> string <span class="token operator">=</span> foo<span class="token punctuation">;</span> <span class="token comment">// works</span>
</code></pre></div><p>if语句、函数和其他有条件运行的代码都可以阻止Flow精确地计算出类型是什么</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">let</span> foo <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  foo <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  foo <span class="token operator">=</span> <span class="token string">'hello'</span>
<span class="token punctuation">}</span>
<span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">let</span> isString<span class="token operator">:</span> string <span class="token operator">=</span> foo<span class="token punctuation">;</span>   <span class="token comment">// Error</span>
</code></pre></div><h3 id="function-types-函数类型">Function Types(函数类型)</h3> <p>函数有两个地方需要定义类型，一个是参数，一个是返回值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow </span>
<span class="token keyword">function</span> <span class="token function">concat</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span>string<span class="token punctuation">,</span>b<span class="token operator">:</span>string</span><span class="token punctuation">)</span><span class="token operator">:</span>string <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b
<span class="token punctuation">}</span>
<span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token function">concat</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Error</span>
</code></pre></div><p>即使不用类型注释，有些类型也会自动检测</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">concat</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> a<span class="token operator">+</span> b
<span class="token punctuation">}</span>
<span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token function">concat</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error</span>
</code></pre></div><p>有时候 Flow 会创建一种你比较希望的类型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">concat</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Works!</span>
<span class="token function">concat</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// Works!</span>
</code></pre></div><h3 id="函数语法">函数语法</h3> <p>有三种形式的函数，每种形式都有各自略有不同的语法。</p> <h3 id="函数声明">函数声明</h3> <p>添加类型和不添加类型的函数声明语法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token parameter">str<span class="token punctuation">,</span> bool<span class="token punctuation">,</span> <span class="token operator">...</span>nums</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token parameter">str<span class="token operator">:</span> string<span class="token punctuation">,</span> bool<span class="token operator">?</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span> <span class="token operator">...</span>nums<span class="token operator">:</span> Array<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="箭头函数">箭头函数</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">method</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">str<span class="token punctuation">,</span> bool<span class="token punctuation">,</span> <span class="token operator">...</span>nums</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> method <span class="token operator">=</span> <span class="token punctuation">(</span>str<span class="token operator">:</span> string<span class="token punctuation">,</span> bool<span class="token operator">?</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span> <span class="token operator">...</span>nums<span class="token operator">:</span> Array<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token parameter"><span class="token keyword">void</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="函数类型">函数类型</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token parameter">str<span class="token operator">:</span> string<span class="token punctuation">,</span> bool<span class="token operator">?</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span> <span class="token operator">...</span>nums<span class="token operator">:</span> Array<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
</code></pre></div><p>省略参数名</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token parameter">string<span class="token punctuation">,</span> boolean <span class="token operator">|</span> <span class="token keyword">void</span><span class="token punctuation">,</span> Array<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
</code></pre></div><p>您可以将这些函数类型用于诸如回调之类的操作。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token parameter">param1<span class="token operator">:</span> string<span class="token punctuation">,</span> param2<span class="token operator">:</span> boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="可选参数">可选参数</h3> <p>您还可以通过在参数名称后面和冒号：之前添加一个问号来拥有可选参数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token parameter">optionalValue<span class="token operator">?</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><p>可选参数可以不传或者undefined或匹配的类型。但他们不会接受NUll</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token parameter">optionalValue<span class="token operator">?</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// works</span>
<span class="token function">method</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'string'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token function">method</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Error</span>
</code></pre></div><h3 id="rest参数">Rest参数</h3> <p>在参数列表 末尾 末尾 末尾 手机参数数组的参数， 用 ... 来表示</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token operator">:</span> Array<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><p>你可以将任意多的参数传递到rest参数中</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token operator">:</span> Array<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token function">method</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token function">method</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// works</span>
<span class="token function">method</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>需要注意的是，如果你向rest参数添加类型注释，则必须是数组类型的。</p></div> <h3 id="返回值">返回值</h3> <p>函数返回还可以使用冒号：添加类型，然后在参数列表后添加类型。如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> number<span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><p>返回类型确保函数的每个分支返回相同的类型。这样可以防止你在某些情况下意外的不返回值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">function</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> boolean<span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    reurn <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>JavaScript中的每个函数都可以使用一个名为 this 的特殊上下文来调用。您可以使用所需的任何上下文调用函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> num<span class="token operator">:</span> number <span class="token operator">=</span> <span class="token function">method</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">var</span> str<span class="token operator">:</span> string <span class="token operator">=</span> <span class="token function">method</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="predicate函数（额-谓词函数）">Predicate函数（额...谓词函数）</h3> <p>有时，你可能希望将条件从if语句移到函数中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">concat</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span> <span class="token operator">?</span>string<span class="token punctuation">,</span>b<span class="token operator">:</span> <span class="token operator">?</span>string</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token string">''</span>
<span class="token punctuation">}</span>
</code></pre></div><p>但是，Flow将在下面的代码中会出错：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">truthy</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span><span class="token operator">:</span> boolean <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">concat</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span> <span class="token operator">?</span>string<span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token operator">?</span>string</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">truthy</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// $ExpectError</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>您可以通过使truthy成为谓词函数来解决这个问题，可以使用 %check 注释，如下所示：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">truthy</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span><span class="token operator">:</span> boolean <span class="token operator">%</span>checks <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span>a <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token operator">!</span>b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">concat</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span> <span class="token operator">?</span>string<span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token operator">?</span>string</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">truthy</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这些谓词函数的主体必须是表达式(即不支持局部变量声明)。但也可以调用谓词函数中的其他谓词函数。例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">isString</span><span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token operator">%</span>checks <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">typeof</span> y <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">isNumber</span><span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token operator">%</span>checks <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">typeof</span> y <span class="token operator">===</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">isNumberOrString</span><span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token operator">%</span>checks <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">isString</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isNumber</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token operator">|</span> number <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNumberOrString</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> x<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">// no error, because Flow infers that x can only be an array</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="callable-objects-可调用对象（本人对这个也不是特别理解，望有大神指出）">Callable Objects 可调用对象（本人对这个也不是特别理解，望有大神指出）</h3> <p>可以输入可调用对象，例如:</p> <div class="language-js extra-class"><pre class="language-js"><code>type CallableObj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">(</span>number<span class="token punctuation">,</span> number<span class="token punctuation">)</span><span class="token operator">:</span> number<span class="token punctuation">,</span>
  bar<span class="token operator">:</span> string
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token comment">// $ExpectError</span>
<span class="token punctuation">(</span>add<span class="token operator">:</span> CallableObj<span class="token punctuation">)</span><span class="token punctuation">;</span>

add<span class="token punctuation">.</span>bar <span class="token operator">=</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span>add<span class="token operator">:</span> CallableObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="function-type">Function Type</h3> <p>有时候参数要接受任意函数的类型:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token function-variable function">func</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> mixed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果你需要选择退出类型检测程序，同时你有不想用any类型,你可以用function类型</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">func</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// Works.</span>
  <span class="token function">func</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Works.</span>
  <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Works.</span>
<span class="token punctuation">}</span>

<span class="token function">method</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span> number<span class="token punctuation">,</span> b<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="对象类型语法">对象类型语法</h3> <p>对象类型尽可能地尝试匹配JavaScript中对象的语法。使用冒号使用花括号{}和名称-值对：用逗号分隔，。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">var</span> obj1<span class="token operator">:</span> <span class="token punctuation">{</span>foo<span class="token operator">:</span> boolean<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>foo<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> obj2<span class="token operator">:</span> <span class="token punctuation">{</span>
  foo<span class="token operator">:</span> number<span class="token punctuation">,</span>
  bar<span class="token operator">:</span> boolean<span class="token punctuation">,</span>
  baz<span class="token operator">:</span> string
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  bar<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  baz<span class="token operator">:</span> <span class="token string">'three'</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="可选对象类型属性">可选对象类型属性</h3> <p>在JavaScript中，访问不存在的属性的计算结果为undefined。这是JavaScript程序中常见的错误来源，因此Flow将这些错误转换为类型错误。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>foo<span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// $ExpectError</span>
obj<span class="token punctuation">.</span>bar<span class="token punctuation">;</span>  <span class="token comment">// Error!  cannot get `obj.bar` beacuse property `bar` is missing in object litera [1].</span>
</code></pre></div><p>如果你有一个有时没有属性的对象，可以通过在对象类型中的属性名称之后添加问号使其成为可选属性。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">var</span> obj<span class="token operator">:</span> <span class="token punctuation">{</span>foo<span class="token operator">?</span><span class="token operator">:</span> boolean<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token boolean">true</span>   <span class="token comment">// work</span>
<span class="token comment">// $ExpectError</span>
obj<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>   <span class="token comment">// Error! cannot assign `'hello'` to `obj.foo` because string [1] is incomptible with boolean [2]</span>
</code></pre></div><p>除了它们的设置值类型之外，这些可选属性可以是void，也可以完全省略。但是，它们不能为null</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">acceptsObject</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> <span class="token punctuation">{</span>foo<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token function">acceptsObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>foo<span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// works</span>
<span class="token function">acceptsObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>foo<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// works</span>
<span class="token comment">// $ExpectError</span>
<span class="token function">acceptsObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>foo<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// Error</span>
<span class="token function">acceptsObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// works</span>
</code></pre></div><h3 id="密封对象">密封对象</h3> <p>使用其属性创建对象时，可在Flow中创建密封对象类型。这些密封对象将知道你声明它们的所有属性及其值的类型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  bar<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  baz<span class="token operator">:</span> <span class="token string">'three'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> foo<span class="token operator">:</span> number <span class="token operator">=</span> obj<span class="token punctuation">.</span>foo<span class="token punctuation">;</span>   <span class="token comment">// work</span>
<span class="token keyword">var</span> bar<span class="token operator">:</span> boolean <span class="token operator">=</span> obj<span class="token punctuation">.</span>bar<span class="token punctuation">;</span>   <span class="token comment">// work</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">var</span> baz<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token operator">=</span> obj<span class="token punctuation">.</span>baz<span class="token punctuation">;</span>   <span class="token comment">// Error</span>
<span class="token keyword">var</span> bat<span class="token operator">:</span> string <span class="token operator">=</span> obj<span class="token punctuation">.</span>bat<span class="token punctuation">;</span>  <span class="token comment">// Error</span>
</code></pre></div><p>但是当对象被密封时，Flow将不允许你向它们添加新属性</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
<span class="token comment">// $ExpectError</span>
obj<span class="token punctuation">.</span>bar <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">// Error</span>
<span class="token comment">// $ExpectError</span>
obj<span class="token punctuation">.</span>baz <span class="token operator">=</span> <span class="token string">'three'</span><span class="token punctuation">;</span>  <span class="token comment">// Error</span>
</code></pre></div><h3 id="未密封对象">未密封对象</h3> <p>创建没有任何属性的对象时，可以在Flow中创建未密封的对象类型。这些未密封的对象不会知道它们的所有属性，并允许你添加新属性</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
obj<span class="token punctuation">.</span>bar <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">// works</span>
obj<span class="token punctuation">.</span>baz <span class="token operator">=</span> <span class="token string">'tnree'</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
</code></pre></div><p>属性的推断类型（类型注释）将成为你设置的属性</p> <h3 id="重新分配未密封的对象属性">重新分配未密封的对象属性</h3> <p>类似于var和let变量，如果重新分配未密封对象的属性，默认情况下，Flow会为其指定所有可能分配的类型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> obj<span class="token punctuation">.</span>prop <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">else</span> obj<span class="token punctuation">.</span>prop <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">var</span> var1<span class="token operator">:</span> boolean <span class="token operator">=</span> obj<span class="token punctuation">.</span>prop<span class="token punctuation">;</span>  <span class="token comment">// Error</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">var</span> val2<span class="token operator">:</span> string <span class="token operator">=</span> obj<span class="token punctuation">.</span>prop<span class="token punctuation">;</span>   <span class="token comment">// Error</span>
<span class="token keyword">var</span> val3<span class="token operator">:</span> boolean <span class="token operator">|</span> string <span class="token operator">=</span> obj<span class="token punctuation">.</span>prop<span class="token punctuation">;</span>   <span class="token comment">// work</span>
</code></pre></div><p>有时，Flow能够在重新分配后（确定地）确定属性的类型。在这种情况下，Flow将为其提供已知类型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>prop <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>prop <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">var</span> val1<span class="token operator">:</span> boolean <span class="token operator">=</span> obj<span class="token punctuation">.</span>prop<span class="token punctuation">;</span>  <span class="token comment">// Error</span>
<span class="token keyword">var</span> val2<span class="token operator">:</span> string <span class="token operator">=</span> obj<span class="token punctuation">.</span>prop<span class="token punctuation">;</span>  <span class="token comment">// works</span>
</code></pre></div><h3 id="未密封对象上的未知属性查找是不安全的">未密封对象上的未知属性查找是不安全的</h3> <p>未密封的对象允许随时写入新属性。Flow确保读取与写入兼容，但不确保在读取之前发生写入（按执行顺序）
这意味着永远不会检查没有匹配写入的未密封对象的读取。这是Flow的一种不安全行为，将来可能得到改善。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>bar <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> foo<span class="token operator">:</span> number <span class="token operator">=</span> obj<span class="token punctuation">.</span>foo<span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token keyword">var</span> bar<span class="token operator">:</span> boolean <span class="token operator">=</span> obj<span class="token punctuation">.</span>bar<span class="token punctuation">;</span>  <span class="token comment">// works</span>
<span class="token keyword">var</span> baz<span class="token operator">:</span> string <span class="token operator">=</span> obj<span class="token punctuation">.</span>baz<span class="token punctuation">;</span>   <span class="token comment">// works</span>
</code></pre></div><h3 id="精确对象类型">精确对象类型</h3> <p>在Flow中，传递具有额外属性的对象被认为是安全的，其中期望正常的对象类型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token operator">:</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> string <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Works!</span>
  bar<span class="token operator">:</span> <span class="token number">42</span>      <span class="token comment">// Works!</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>有时禁用此行为并仅允许一组特定属性很有用。为此，Flow支持“精确”对象类型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span><span class="token operator">|</span> foo<span class="token operator">:</span> string<span class="token punctuation">,</span> bar<span class="token operator">:</span> number <span class="token operator">|</span><span class="token punctuation">}</span>
</code></pre></div><p>与常规对象类型不同，将具有“额外”属性的对象传递给精确对象类型无效。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">var</span> foo<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">|</span> foo<span class="token operator">:</span> string <span class="token operator">|</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span> bar<span class="token operator">:</span> <span class="token string">&quot;World!&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Error!</span>
</code></pre></div><p>确切对象类型的交集可能无法按预期工作。如果需要组合确切的对象类型，请使用对象类型传播：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
type FooT <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">|</span> foo<span class="token operator">:</span> string <span class="token operator">|</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
type BarT <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">|</span> bar<span class="token operator">:</span> number <span class="token operator">|</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
type FooBarFailT <span class="token operator">=</span> FooT <span class="token operator">&amp;</span> BarT<span class="token punctuation">;</span>
type FooBarT <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">|</span> <span class="token operator">...</span>FooT<span class="token punctuation">,</span> <span class="token operator">...</span>BarT <span class="token operator">|</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fooBarFail<span class="token operator">:</span> FooBarFailT <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'123'</span><span class="token punctuation">,</span> bar<span class="token operator">:</span> <span class="token number">12</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Error!</span>
<span class="token keyword">const</span> fooBar<span class="token operator">:</span> FooBarT <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'123'</span><span class="token punctuation">,</span> bar<span class="token operator">:</span> <span class="token number">12</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Works!</span>
</code></pre></div><h3 id="objectsasmaps">ObjectsAsMaps</h3> <p>较新版本的JavaScript标准包含一个Map类，但将对象用作Maps仍然很常见。在此用例中，对象可能会添加属性并在其整个生命周期中检索。此外，属性键甚至可能不是静态已知的，因此写出类型注释是不可能的。
对于像这样的对象，Flow提供了一种特殊的属性，称为“索引器属性”。索引器属性允许使用与索引器键类型匹配的任何键进行读写。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">var</span> o<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>string<span class="token punctuation">]</span><span class="token operator">:</span> number <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
o<span class="token punctuation">[</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
o<span class="token punctuation">[</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> foo<span class="token operator">:</span> number <span class="token operator">=</span> o<span class="token punctuation">[</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>可以选择命名索引器，以用于文档目的：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">var</span> obj<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>user_id<span class="token operator">:</span> number<span class="token punctuation">]</span><span class="token operator">:</span> string <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
obj<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;Julia&quot;</span><span class="token punctuation">;</span>
obj<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;Camille&quot;</span><span class="token punctuation">;</span>
obj<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;Justin&quot;</span><span class="token punctuation">;</span>
obj<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;Mark&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>当对象类型具有索引器属性时，假定属性访问具有带注释的类型，即使该对象在运行时没有该槽中的值。程序员有责任确保访问是安全的，就像数组一样。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> obj<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>number<span class="token punctuation">]</span><span class="token operator">:</span> string <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
obj<span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">//没有类型错误，但会在运行时抛出</span>
</code></pre></div><p>索引器属性可以与命名属性混合使用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">var</span> obj<span class="token operator">:</span> <span class="token punctuation">{</span>
  size<span class="token operator">:</span> number<span class="token punctuation">,</span>
  <span class="token punctuation">[</span>id<span class="token operator">:</span> number<span class="token punctuation">]</span><span class="token operator">:</span> string
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  size<span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token operator">:</span> number<span class="token punctuation">,</span> name<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  obj<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> name<span class="token punctuation">;</span>
  obj<span class="token punctuation">.</span>size<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="object-type">Object Type</h3> <p>有时编写接受任意对象的类型是有用的，对于那些你应该写{}的类似：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><p>但是，如果您需要选择退出类型检查程序，并且不想一直转到任何类型检查程序，则可以改为使用Object。Object 不安全，应该避免。
例如，以下代码不会报告任何错误：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  obj<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>               <span class="token comment">// Works.</span>
  <span class="token keyword">let</span> bar<span class="token operator">:</span> boolean <span class="token operator">=</span> obj<span class="token punctuation">.</span>bar<span class="token punctuation">;</span> <span class="token comment">// Works.</span>
  obj<span class="token punctuation">.</span>baz<span class="token punctuation">.</span>bat<span class="token punctuation">.</span>bam<span class="token punctuation">.</span>bop<span class="token punctuation">;</span>        <span class="token comment">// Works.</span>
<span class="token punctuation">}</span>
<span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">{</span> baz<span class="token operator">:</span> <span class="token number">3.14</span><span class="token punctuation">,</span> bar<span class="token operator">:</span> <span class="token string">&quot;hello&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="数组类型">数组类型</h3> <p>要创建数组类型，可以使用<code>Array&lt;Type&gt;type</code>, 其中Type是数组中元素的类型。例如，要为数组创建类型，请使用<code>Array&lt;number&gt;</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> arr<span class="token operator">:</span> Array<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
</code></pre></div><p>you can put any type within <code>Array&lt;Type&gt;</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> arr1<span class="token operator">:</span> Array<span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> arr2<span class="token operator">:</span> Array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">,</span><span class="token string">'C'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> arr3<span class="token operator">:</span> Array<span class="token operator">&lt;</span>mixed<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">'three'</span><span class="token punctuation">]</span>
</code></pre></div><h4 id="快速语法">快速语法</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> arr<span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
</code></pre></div><p>请注意，<code>？Type[]</code>相当于<code>?Array&lt;T&gt;</code>而不是Array<code>&lt;? T&gt;</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">let</span> arr1<span class="token operator">:</span> <span class="token operator">?</span>number<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// works</span>
<span class="token keyword">let</span> arr2<span class="token operator">:</span> <span class="token operator">?</span>number<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// works</span>
<span class="token keyword">let</span> arr3<span class="token operator">:</span> <span class="token operator">?</span>number<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">null</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// Error</span>
</code></pre></div><p>如果你想使它成为<code>Array&lt;? T&gt;</code>你可以使用括号，如：<code>(? Type)[]</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">let</span> arr1<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">?</span>number<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>   <span class="token comment">// Error</span>
<span class="token keyword">let</span> arr2<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">?</span>number<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// works</span>
<span class="token keyword">let</span> arr3<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">?</span>number<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">null</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// works</span>
</code></pre></div><h3 id="数组访问不安全">数组访问不安全</h3> <p>从数组中检索元素时，始终存在未定义的元素。你可以访问一个超出数组边界的索引，或者该元素不能存在，因为它是一个’稀疏数组‘。
例如，你可能正在访问超出数组范围的元素</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">let</span> array<span class="token operator">:</span> Array<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> value<span class="token operator">:</span> number <span class="token operator">=</span> array<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// works  undefined</span>
</code></pre></div><p>或者你可以访问一个不存在的元素，如果它是一个’稀疏数组‘</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">let</span> array<span class="token operator">:</span> Array<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
array<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> value<span class="token operator">:</span> number <span class="token operator">=</span> array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// works  undefined</span>
</code></pre></div><p>为了使这个安全，Flow必须将每个单独的数组访问标记为“可能未定义”。
Flow不会这样做，因为它使用起来非常不方便。你讲被迫优化访问数组时获得的每个值的类型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> array<span class="token operator">:</span> Array<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> value<span class="token operator">:</span> number <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token operator">=</span> array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// number</span>
<span class="token punctuation">}</span>
</code></pre></div><p>由于Flow变得更加智能，将来有可能解决这个问题，但是现在你应该意识到这一点。</p> <h3 id="元组类型">元组类型</h3> <p>元组是一种列表，但具有有限的项目集。在JavaScript中，使用数组创建元组。
在Flow中，你可以使用[type,type,type]语法创建元组。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> tuple1<span class="token operator">:</span> <span class="token punctuation">[</span>number<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> tuple2<span class="token operator">:</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span>boolean<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> tuple3<span class="token operator">:</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span>boolean<span class="token punctuation">,</span>string<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">'three'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>当你从特定索引处的元组获取值时，它将返回该索引处的类型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">let</span> tuple<span class="token operator">:</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span>boolean<span class="token punctuation">,</span>string<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">'three'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> num<span class="token operator">:</span> number <span class="token operator">=</span> tuple<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token keyword">let</span> bool<span class="token operator">:</span> boolean <span class="token operator">=</span> tuple<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// works</span>
<span class="token keyword">let</span> str<span class="token operator">:</span> string <span class="token operator">=</span> tuple<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// works</span>
</code></pre></div><p>如果你尝试不存在的索引获取它将返回一种void。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">let</span> tuple<span class="token operator">:</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span>boolean<span class="token punctuation">,</span>string<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">'three'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> none<span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=</span> tuple<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>如果Flow不知道你尝试访问哪个索引，它将返回所有可能的类型</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">let</span> tuple<span class="token operator">:</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span>boolean<span class="token punctuation">,</span>string<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">'three'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">getItem</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token operator">:</span>number</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> val<span class="token operator">:</span> number <span class="token operator">|</span> boolean <span class="token operator">|</span> string <span class="token operator">=</span> tuple<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在元组内设置新值时，新值必须与该索引处的类型匹配</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">let</span> tuple<span class="token operator">:</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span>boolean<span class="token punctuation">,</span>string<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">'three'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
tuple<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token comment">// works</span>
tuple<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token comment">// works</span>
tuple<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span>  <span class="token comment">// works</span>
<span class="token comment">// $ExpectError</span>
tuple<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'bar'</span><span class="token punctuation">;</span>  <span class="token comment">// Error</span>
tuple<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>  <span class="token comment">// Error</span>
tuple<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token comment">// Error</span>
</code></pre></div><h4 id="严格执行元组长度">严格执行元组长度</h4> <p>元组的长度称为“arity”。在Flow中严格执行元组的长度。
<strong>元组只匹配相同长度的元组</strong>
他的意思是不能使用较短的元组代替较长的元组。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">let</span> tuple1<span class="token operator">:</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span>boolean<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">let</span> tuple2<span class="token operator">:</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span>boolean<span class="token punctuation">,</span><span class="token keyword">void</span><span class="token punctuation">]</span> <span class="token operator">=</span> tuple1<span class="token punctuation">;</span>  <span class="token comment">// Error</span>
</code></pre></div><p>此外，不能使用较长的元组来代替较短的元组。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">let</span> tuple1<span class="token operator">:</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span>boolean<span class="token punctuation">,</span><span class="token keyword">void</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">let</span> tuple2<span class="token operator">:</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span>boolean<span class="token punctuation">]</span> <span class="token operator">=</span> tuple1<span class="token punctuation">;</span> <span class="token comment">// Error</span>
</code></pre></div><h4 id="元组与数组类型不匹配">元组与数组类型不匹配</h4> <p>由于Flow不知道数组的长度，因此无法将<code>Array &lt;T&gt;</code>类型传递给元组。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">let</span> array<span class="token operator">:</span> Array<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">let</span> tuple<span class="token operator">:</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span>number<span class="token punctuation">]</span> <span class="token operator">=</span> array<span class="token punctuation">;</span> <span class="token comment">// Error</span>
</code></pre></div><p>另外一个元组类型不能传递给<code>Array &lt;T&gt;</code>类型，因为那样你就可以以不安全的方式改变元组。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">let</span> tuple<span class="token operator">:</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span>number<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">let</span> array<span class="token operator">:</span> Array<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span> <span class="token operator">=</span> tuple<span class="token punctuation">;</span>  <span class="token comment">// Error</span>
</code></pre></div><h4 id="不能在元组上使用变异数组方法">不能在元组上使用变异数组方法</h4> <p>你不能使用改变元组的Array.prototype方法，只能使用不改变元组的方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">let</span> tuple<span class="token operator">:</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span>number<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
tuple<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// works</span>
<span class="token comment">// $ExpectError</span>
tuple<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Error</span>
</code></pre></div><h3 id="class类型">Class类型</h3> <p>Flow中的JavaScript类既可以作为值，也可以作为类型。
你可以像没有Flow一样编写类，但是你可以使用类的名称作为类型</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token keyword">let</span> myInstance<span class="token operator">:</span> MyClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Flow中的类与普通的JavaScript类相同，但添加了类型</p> <h4 id="class-方法">Class 方法</h4> <p>就像在函数中一样，类方法可以参数（输入）和返回（输出）的注释</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
  <span class="token function">method</span><span class="token punctuation">(</span>value<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> number <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="class-字段（属性）">class 字段（属性）</h4> <p>每当要在Flow中使用类字段时，必须先给一个注释</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
  <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// $ExpectError</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>prop <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>  <span class="token comment">// Error</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面的方式是错误的在flow中。字段在类的主体内注释，字段名称后冒号：和类型</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
  prop<span class="token operator">:</span> number<span class="token punctuation">;</span>
  <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>prop <span class="token operator">=</span> <span class="token number">42</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Flow还支持使用类属性语法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
  prop <span class="token operator">=</span> <span class="token number">42</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用此语法时，不需要为其指定类型注释。但如果你需要，你可以</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
  prop<span class="token operator">:</span> number <span class="token operator">=</span> <span class="token number">42</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="类泛型">类泛型</h4> <p>classes 也可以有自己的泛型</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span><span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span><span class="token constant">B</span><span class="token punctuation">,</span><span class="token constant">C</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  property<span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">;</span>
  <span class="token function">method</span><span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token constant">B</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">C</span> <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>类泛型是参数化的。当您使用类作为类型时，您需要为每个泛型传递参数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">class</span> <span class="token class-name">MyClass</span><span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span><span class="token constant">B</span><span class="token punctuation">,</span><span class="token constant">C</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">arg1<span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">,</span>arg2<span class="token operator">:</span> <span class="token constant">B</span><span class="token punctuation">,</span>arg3<span class="token operator">:</span> <span class="token constant">C</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> val<span class="token operator">:</span> MyClass<span class="token operator">&lt;</span>number<span class="token punctuation">,</span>boolean<span class="token punctuation">,</span>string<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">'three'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="类型别名">类型别名</h3> <p>当您有要在多个位置重用的复杂类型时，可以使用 类型别名 在Flow中对它们进行别名</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
type MyObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  foo<span class="token operator">:</span> number<span class="token punctuation">,</span>
  bar<span class="token operator">:</span> boolean<span class="token punctuation">,</span>
  baz<span class="token operator">:</span> string
<span class="token punctuation">}</span>
</code></pre></div><p>这些类型的别名可以在任何可以使用类型的地方使用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
type MyObject <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">var</span> val<span class="token operator">:</span> MyObejct <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token parameter">val<span class="token operator">:</span> MyObject</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">val<span class="token operator">:</span> MyObecjt</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre></div><h4 id="类型别名语法">类型别名语法</h4> <p>使用关键字type后跟其名称，等号=和类型定义来创建类型别名。</p> <div class="language-js extra-class"><pre class="language-js"><code>type Alias <span class="token operator">=</span> Type
</code></pre></div><p>任何类型都可以出现在类型别名中</p> <div class="language-js extra-class"><pre class="language-js"><code>type NumberAlias <span class="token operator">=</span> number<span class="token punctuation">;</span>
type ObjectAlias <span class="token operator">=</span> <span class="token punctuation">{</span>
  property<span class="token operator">:</span> string<span class="token punctuation">,</span>
  <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> number
<span class="token punctuation">}</span>
type UnionAlias <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">3</span><span class="token punctuation">;</span>
type AliasAlias <span class="token operator">=</span> ObjectAlias
</code></pre></div><h4 id="类型别名泛型">类型别名泛型</h4> <p>类型别名也可以有自己的泛型。</p> <div class="language-js extra-class"><pre class="language-js"><code>type MyObject<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span><span class="token constant">B</span><span class="token punctuation">,</span><span class="token constant">C</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  property<span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">,</span>
  <span class="token function">method</span><span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token constant">B</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">C</span>
<span class="token punctuation">}</span>
</code></pre></div><p>类型别名泛型已参数化。当您使用类型别名时，您需要为每个泛型传递参数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
type MyObject<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span><span class="token constant">B</span><span class="token punctuation">,</span><span class="token constant">C</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">,</span>
  bar<span class="token operator">:</span> <span class="token constant">B</span><span class="token punctuation">,</span>
  baz<span class="token operator">:</span> <span class="token constant">C</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> val<span class="token operator">:</span> MyObject<span class="token operator">&lt;</span>number<span class="token punctuation">,</span>boolean<span class="token punctuation">,</span>string<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  bar<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  baz<span class="token operator">:</span> <span class="token string">'three'</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="不透明类型别名">不透明类型别名</h4> <p>不透明类型别名是类型别名，不允许在定义它们的文件之外访问其基础类型。</p> <div class="language-js extra-class"><pre class="language-js"><code>opaque type <span class="token constant">ID</span> <span class="token operator">=</span> string
</code></pre></div><p>与常规类型别名一样，可以在任何可以使用类型的地方使用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
opaque type <span class="token constant">ID</span> <span class="token operator">=</span> string<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">identity</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token operator">:</span> <span class="token constant">ID</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">ID</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x
<span class="token punctuation">}</span>
<span class="token keyword">export</span> type <span class="token punctuation">{</span><span class="token constant">ID</span><span class="token punctuation">}</span>
</code></pre></div><h4 id="不透明类型语法">不透明类型语法</h4> <p>您可以选择通过添加冒号来添加子类型约束到opaque类型别名：和名称后面的类型。</p> <div class="language-js extra-class"><pre class="language-js"><code>opaque type Alias<span class="token operator">:</span> SuperType <span class="token operator">=</span> Type<span class="token punctuation">;</span>
</code></pre></div><p>任何类型都可以显示为不透明类型别名的超类型或类型。</p> <div class="language-js extra-class"><pre class="language-js"><code>opaque type StringAlias <span class="token operator">=</span> string<span class="token punctuation">;</span>
opaque type ObjectAlias <span class="token operator">=</span> <span class="token punctuation">{</span>
  property<span class="token operator">:</span> string<span class="token punctuation">,</span>
  <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> number<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
opaque type UnionAlias <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">3</span><span class="token punctuation">;</span>
opaque type AliasAlias<span class="token operator">:</span> ObjectAlias <span class="token operator">=</span> ObjectAlias<span class="token punctuation">;</span>
opaque type VeryOpaque<span class="token operator">:</span> AliasAlias <span class="token operator">=</span> ObjectAlias<span class="token punctuation">;</span>
</code></pre></div><p>当在同一文件中定义别名时，opaque类型别名的行为与常规类型别名的行为完全相同</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//@flow</span>
opaque type NumberAlias <span class="token operator">=</span> number<span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span> NumberAlias<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token operator">:</span> NumberAlias<span class="token punctuation">,</span> y<span class="token operator">:</span> NumberAlias</span><span class="token punctuation">)</span><span class="token operator">:</span> NumberAlias <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">toNumberAlias</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token operator">:</span> number</span><span class="token punctuation">)</span><span class="token operator">:</span> NumberAlias <span class="token punctuation">{</span> <span class="token keyword">return</span> x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">toNumber</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token operator">:</span> NumberAlias</span><span class="token punctuation">)</span><span class="token operator">:</span> number <span class="token punctuation">{</span> <span class="token keyword">return</span> x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div><p>导入opaque类型别名时，它的行为类似于名义类型，隐藏其基础类型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// exports.js</span>
<span class="token keyword">export</span> opaque type NumberAlias <span class="token operator">=</span> number<span class="token punctuation">;</span>
<span class="token comment">// imports.js</span>
<span class="token keyword">import</span> type <span class="token punctuation">{</span>NumberAlias<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./exports'</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span> NumberAlias<span class="token punctuation">)</span> <span class="token comment">// Error: 0 is not a NumberAlias!</span>
<span class="token keyword">function</span> <span class="token function">convert</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token operator">:</span> NumberAlias</span><span class="token punctuation">)</span><span class="token operator">:</span> number <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x<span class="token punctuation">;</span> <span class="token comment">// Error: x is not a number!</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="子类型约束">子类型约束</h4> <p>将子类型约束添加到opaque类型别名时，我们允许opaque类型在定义文件之外时用作超类型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// exports.js</span>
<span class="token keyword">export</span> opaque type <span class="token constant">ID</span><span class="token operator">:</span> string <span class="token operator">=</span> string<span class="token punctuation">;</span>
<span class="token comment">// imports.js</span>
<span class="token keyword">import</span> type <span class="token punctuation">{</span><span class="token constant">ID</span><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./exports'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">formatID</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token operator">:</span> <span class="token constant">ID</span></span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">&quot;ID: &quot;</span><span class="token operator">+</span> x<span class="token punctuation">;</span>   <span class="token comment">// ok! IDs are strings</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">toID</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">ID</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x<span class="token punctuation">;</span>   <span class="token comment">// Error: strings are not IDs</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用子类型约束创建opaque类型别名时，类型位置中的类型必须是超类型位置中类型的子类型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
opaque type Bad<span class="token operator">:</span> string <span class="token operator">=</span> number<span class="token punctuation">;</span>   <span class="token comment">// Error: number is not a subtype of string</span>
opaque type Good<span class="token operator">:</span> <span class="token punctuation">{</span>x<span class="token operator">:</span> string<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">:</span> string<span class="token punctuation">,</span>y<span class="token operator">:</span> number<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="泛型">泛型</h4> <p>不透明类型的别名也可以有自己的泛型，它们的工作方式与普通类型别名中的泛型一样</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
opaque type MyObject<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span><span class="token constant">B</span><span class="token punctuation">,</span><span class="token constant">C</span><span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token punctuation">{</span>foo<span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">,</span>bar<span class="token operator">:</span> <span class="token constant">B</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">,</span>
  bar<span class="token operator">:</span> <span class="token constant">B</span><span class="token punctuation">,</span>
  baz<span class="token operator">:</span> <span class="token constant">C</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> val<span class="token operator">:</span> MyObject<span class="token operator">&lt;</span>number<span class="token punctuation">,</span>boolean<span class="token punctuation">,</span>string<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  bar<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  baz<span class="token operator">:</span> <span class="token string">'three'</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="library-definitions">Library Definitions</h4> <p>你可以在libdefs中声明opaque类型别名。在那里，你省略了基础类型，但仍可选择包含超类型</p> <div class="language-js extra-class"><pre class="language-js"><code>declare opaque type Foo
declare opaque type PositiveNumber<span class="token operator">:</span> number
</code></pre></div><h3 id="接口类型">接口类型</h3> <p>Flow中的类名义上是键入的。这意味着当你有两个单独的类时，即使它们具有相同的属性和方法，也不能使用一个类代替另一个。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
  <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">'[Foo]'</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Bar</span> <span class="token punctuation">{</span>
  <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">'[Bar]'</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">const</span> foo<span class="token operator">:</span> Foo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Error</span>
</code></pre></div><p>相反，您可以使用接口来声明您期望的类的结构。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">interface</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
  <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> string
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
  <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">'[Foo]'</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Bar</span> <span class="token punctuation">{</span>
  <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">'[Bar]'</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> foo<span class="token operator">:</span> Serializable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token keyword">const</span> bar<span class="token operator">:</span> Serializeble <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
</code></pre></div><p>您还可以使用implements来告诉Flow您希望该类与接口匹配。这可以防止您在编辑类时进行不兼容的更改。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">interface</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
  <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> string
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
  <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">'[Foo]'</span><span class="token punctuation">}</span>   <span class="token comment">// works</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Bar</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
  <span class="token comment">// $ExpectError</span>
  <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token number">42</span><span class="token punctuation">}</span>  <span class="token comment">// Error</span>
<span class="token punctuation">}</span>
</code></pre></div><p>您还可以使用具有多个接口的工具。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token keyword">implements</span> <span class="token class-name">Bar</span><span class="token punctuation">,</span> Baz <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h4 id="接口语法">接口语法</h4> <p>接口是使用关键字interface，后跟其名称和包含类型定义主体的块创建的。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">MyInterface</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>块的语法与对象类型的语法匹配，并具有所有相同的功能</p> <h4 id="接口方法">接口方法</h4> <p>您可以按照与对象方法相同的语法向接口添加方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">MyInterface</span> <span class="token punctuation">{</span>
  <span class="token function">method</span><span class="token punctuation">(</span>value<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> number
<span class="token punctuation">}</span>
</code></pre></div><h4 id="接口属性">接口属性</h4> <p>您可以按照与对象属性相同的语法向接口添加属性。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">MyInterface</span> <span class="token punctuation">{</span>
  property<span class="token operator">:</span> string
<span class="token punctuation">}</span>
</code></pre></div><p>接口属性也是可选的。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">MyInterface</span> <span class="token punctuation">{</span>
  property<span class="token operator">?</span><span class="token operator">:</span> string
<span class="token punctuation">}</span>
</code></pre></div><h4 id="接口maps">接口Maps</h4> <p>您可以使用与对象相同的方式创建“索引器属性”。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">MyInterface</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>key<span class="token operator">:</span> string<span class="token punctuation">]</span><span class="token operator">:</span> number
<span class="token punctuation">}</span>
</code></pre></div><h4 id="接口泛型">接口泛型</h4> <p>接口也可以有自己的泛型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">MyInterface</span><span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span><span class="token constant">B</span><span class="token punctuation">,</span><span class="token constant">C</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  property<span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">;</span>
  <span class="token function">method</span><span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token constant">B</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">C</span>
<span class="token punctuation">}</span>
</code></pre></div><p>接口泛型已参数化。使用接口时，需要为每个泛型传递参数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">interface</span> <span class="token class-name">MyInterface</span><span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span><span class="token constant">B</span><span class="token punctuation">,</span><span class="token constant">C</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">;</span>
  bar<span class="token operator">:</span> <span class="token constant">B</span><span class="token punctuation">;</span>
  baz<span class="token operator">:</span> <span class="token constant">C</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> val<span class="token operator">:</span> MyInterface<span class="token operator">&lt;</span>number<span class="token punctuation">,</span> boolean<span class="token punctuation">,</span> string<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  bar<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  baz<span class="token operator">:</span> <span class="token string">'three'</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="接口属性变量（只读和只写）">接口属性变量（只读和只写）</h4> <p>默认情况下，接口属性是不变的。但是你可以添加修饰符以使它们协变（只读）或逆变（只写）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">MyInterface</span> <span class="token punctuation">{</span>
  <span class="token operator">+</span>covariant<span class="token operator">:</span> number<span class="token punctuation">;</span>   <span class="token comment">// read-only</span>
  <span class="token operator">-</span>contravariant<span class="token operator">:</span> number<span class="token punctuation">;</span> <span class="token comment">// write-only</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="接口上的协变（只读）属性">接口上的协变（只读）属性</h4> <p>您可以通过在属性名称前添加加号+来使属性协变。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">MyInterface</span> <span class="token punctuation">{</span>
  <span class="token operator">+</span>readOnly<span class="token operator">:</span> number <span class="token operator">|</span> string<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这允许您传递更具体的类型来代替该属性。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">interface</span> <span class="token class-name">Invariant</span> <span class="token punctuation">{</span>  property<span class="token operator">:</span> number <span class="token operator">|</span> string <span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Covariant</span> <span class="token punctuation">{</span> <span class="token operator">+</span>readOnly<span class="token operator">:</span> number <span class="token operator">|</span> string <span class="token punctuation">}</span>

<span class="token keyword">var</span> value1<span class="token operator">:</span> Invariant <span class="token operator">=</span> <span class="token punctuation">{</span> property<span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Error!</span>
<span class="token keyword">var</span> value2<span class="token operator">:</span> Covariant <span class="token operator">=</span> <span class="token punctuation">{</span> readOnly<span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Works!</span>
</code></pre></div><p>由于协方差的工作原理，协变属性在使用时也变为只读。这对普通属性有用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">interface</span> <span class="token class-name">Invariant</span> <span class="token punctuation">{</span>  property<span class="token operator">:</span> number <span class="token operator">|</span> string <span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Covariant</span> <span class="token punctuation">{</span> <span class="token operator">+</span>readOnly<span class="token operator">:</span> number <span class="token operator">|</span> string <span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> Invariant</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  value<span class="token punctuation">.</span>property<span class="token punctuation">;</span>        <span class="token comment">// Works!</span>
  value<span class="token punctuation">.</span>property <span class="token operator">=</span> <span class="token number">3.14</span><span class="token punctuation">;</span> <span class="token comment">// Works!</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> Covariant</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  value<span class="token punctuation">.</span>readOnly<span class="token punctuation">;</span>        <span class="token comment">// Works!</span>
  <span class="token comment">// $ExpectError</span>
  value<span class="token punctuation">.</span>readOnly <span class="token operator">=</span> <span class="token number">3.14</span><span class="token punctuation">;</span> <span class="token comment">// Error!</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="接口上的逆变（只写）属性">接口上的逆变（只写）属性</h4> <p>您可以通过在属性名称前添加减号来创建属性逆变。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">InterfaceName</span> <span class="token punctuation">{</span>
  <span class="token operator">-</span>writeOnly<span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这允许您传递一个不太具体的类型来代替该属性。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow </span>
<span class="token keyword">interface</span> <span class="token class-name">Invariant</span> <span class="token punctuation">{</span>property<span class="token operator">:</span> number<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Contravariant</span> <span class="token punctuation">{</span><span class="token operator">-</span>writeOnly<span class="token operator">:</span> number<span class="token punctuation">}</span>
<span class="token keyword">var</span> numberOrString <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.5</span> <span class="token operator">?</span> <span class="token number">42</span> <span class="token operator">:</span> <span class="token string">'forty-two'</span><span class="token punctuation">;</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">var</span> value1<span class="token operator">:</span> Invariant <span class="token operator">=</span> <span class="token punctuation">{</span>property<span class="token operator">:</span> numberOrString<span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// Error</span>
<span class="token keyword">var</span> value2<span class="token operator">:</span> Contravariant <span class="token operator">=</span> <span class="token punctuation">{</span>writeOnly<span class="token operator">:</span> numberOrString<span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// works</span>
</code></pre></div><p>由于逆变的工作原理，逆变属性在使用时也会变为只写。这对普通属性有用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">Invariant</span> <span class="token punctuation">{</span>property<span class="token operator">:</span> number<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Contravariant</span> <span class="token punctuation">{</span><span class="token operator">-</span>writeOnly<span class="token operator">:</span> number<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> Invariant</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  value<span class="token punctuation">.</span>property<span class="token punctuation">;</span>    <span class="token comment">// works</span>
  value<span class="token punctuation">.</span>property <span class="token operator">=</span> <span class="token number">3.13</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> Contravariant</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// $ExpectError</span>
  value<span class="token punctuation">.</span>writeOnly<span class="token punctuation">;</span>   <span class="token comment">// Error</span>
  value<span class="token punctuation">.</span>writeOnly <span class="token operator">=</span> <span class="token number">3.14</span><span class="token punctuation">;</span>  <span class="token comment">// works</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="泛型-2">泛型</h4> <p>泛型（有时称为多态类型）是一种抽象类型的方法。 想象一下编写以下身份函数，它返回传递的任何值。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">identity</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> value
<span class="token punctuation">}</span>
</code></pre></div><p>我们在尝试为此函数编写特定类型时会遇到很多麻烦，因为它可能是任何东西。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">identity</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span>
  <span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>相反，我们可以在函数中创建泛型（或多态类型），并使用它代替其他类型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> identity<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>泛型可以在函数，函数类型，类，类型别名和接口中使用。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>警告：Flow不会推断泛型类型。如果您希望某些东西具有泛型类型，请对其进行注释。否则，Flow可能会推断出比您预期的多态性更低的类型。</p></div> <p>在下面的示例中，我们忘记使用泛型类型正确地注释 identity ，因此当我们尝试将其分配给func时会遇到麻烦。另一方面，genericIdentity已正确输入，我们可以按预期使用它。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
type IdentityWrapper <span class="token operator">=</span> <span class="token punctuation">{</span>
  func<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">identity</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> genericIdentity<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">const</span> bad<span class="token operator">:</span> IdentityWrapper <span class="token operator">=</span> <span class="token punctuation">{</span> func<span class="token operator">:</span> identity <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Error!</span>
<span class="token keyword">const</span> good<span class="token operator">:</span> IdentityWrapper <span class="token operator">=</span> <span class="token punctuation">{</span> func<span class="token operator">:</span> genericIdentity <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Works!</span>
</code></pre></div><h4 id="具有泛型的函数">具有泛型的函数</h4> <p>函数可以通过在函数参数列表之前添加类型参数列表<code>&lt;T&gt;</code>来创建泛型。 您可以在函数（参数或返回类型）中添加任何其他类型的相同位置使用泛型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> method<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>param<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>param<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="具有泛型的函数类型">具有泛型的函数类型</h4> <p>函数类型可以通过在函数类型参数列表之前添加类型参数<code>list &lt;T&gt;</code>，以与普通函数相同的方式创建泛型。 您可以在函数类型（参数或返回类型）中添加任何其他类型的相同位置使用泛型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token parameter">param<span class="token operator">:</span> <span class="token constant">T</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">T</span>
</code></pre></div><p>然后将其用作自己的类型</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token parameter">param<span class="token operator">:</span> <span class="token constant">T</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">T</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h4 id="具有泛型的类">具有泛型的类</h4> <p>类可以通过将类型参数列表放在类的主体之前来创建泛型</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Item</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>你可以在类中添加任何其他类型的相同位置使用泛型（属性类型和方法参数/返回类型）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Item</span><span class="token operator">&lt;</span>t<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  prop<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">param<span class="token operator">:</span> <span class="token constant">T</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>prop <span class="token operator">=</span> param<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>prop
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="具有泛型的类型别名">具有泛型的类型别名</h4> <div class="language-js extra-class"><pre class="language-js"><code>type Item<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span>
  bar<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="具有泛型的接口">具有泛型的接口</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">Item</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span>
  bar<span class="token operator">:</span> <span class="token constant">T</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="泛型特性">泛型特性</h4> <p><strong>泛型就像变量一样</strong>
泛型类型很像变量或函数参数，除了它们用于类型。只要它们在范围内，您就可以使用它们</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> constant<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="根据需要创建尽可能多的泛型">根据需要创建尽可能多的泛型</h4> <p>您可以在类型参数列表中根据需要使用这些泛型，并根据需要命名它们：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> identity<span class="token operator">&lt;</span>One<span class="token punctuation">,</span> Two<span class="token punctuation">,</span> Three<span class="token operator">&gt;</span><span class="token punctuation">(</span>one<span class="token operator">:</span> One<span class="token punctuation">,</span> two<span class="token operator">:</span> Two<span class="token punctuation">,</span> three<span class="token operator">:</span> Three<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="泛型跟踪">泛型跟踪</h4> <p>当对值使用泛型类型时，Flow将跟踪该值并确保您不会将其替换为其他值。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> identity<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token comment">// $ExpectError</span>
  <span class="token keyword">return</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span> <span class="token comment">// Error!</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> identity<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token comment">// $ExpectError</span>
  value <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span> <span class="token comment">// Error!</span>
  <span class="token comment">// $ExpectError</span>
  <span class="token keyword">return</span> value<span class="token punctuation">;</span>  <span class="token comment">// Error!</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Flow跟踪您通过泛型的值的特定类型，以便稍后使用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> identity<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> one<span class="token operator">:</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token function">identity</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> two<span class="token operator">:</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token function">identity</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">let</span> three<span class="token operator">:</span> <span class="token number">3</span> <span class="token operator">=</span> <span class="token function">identity</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="将类型添加到泛型">将类型添加到泛型</h4> <p>与 mixed 类似，泛型具有“未知”类型。您不能使用泛型，就好像它是特定类型一样。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> logFoo<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>obj<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token comment">// $ExpectError</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error!</span>
  <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>您可以优化类型，但泛型仍然允许传入任何类型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> logFoo<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>obj<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">.</span>foo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Works.</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'foo'</span><span class="token punctuation">,</span> bar<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Works.</span>
<span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">{</span> bar<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Works. :(</span>
</code></pre></div><p>相反，您可以像使用函数参数一样为泛型添加类型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> logFoo<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">:</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> string <span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>obj<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Works!</span>
  <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'foo'</span><span class="token punctuation">,</span> bar<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Works!</span>
<span class="token comment">// $ExpectError</span>
<span class="token function">logFoo</span><span class="token punctuation">(</span><span class="token punctuation">{</span> bar<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error!</span>
</code></pre></div><p>这样，您可以保留泛型的行为，同时仅允许使用某些类型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> identity<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">:</span> number<span class="token operator">&gt;</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> one<span class="token operator">:</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token function">identity</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> two<span class="token operator">:</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token function">identity</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">let</span> three<span class="token operator">:</span> <span class="token string">&quot;three&quot;</span> <span class="token operator">=</span> <span class="token function">identity</span><span class="token punctuation">(</span><span class="token string">&quot;three&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="泛型充当边界">泛型充当边界</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> identity<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> val<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> foo<span class="token operator">:</span> <span class="token string">'foo'</span> <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span>           <span class="token comment">// Works!</span>
<span class="token keyword">let</span> bar<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token operator">=</span> <span class="token function">identity</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Works!</span>
</code></pre></div><p>在Flow中，大多数情况下，当你将一种类型传递到另一种类型时，你将失去原始类型。因此，当你将特定类型传递给不太具体的一个流程’界限‘时，它曾经是更具体的东西。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">identity</span><span class="token punctuation">(</span><span class="token parameter">val<span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span>
  <span class="token keyword">return</span> val
<span class="token punctuation">}</span>
<span class="token keyword">let</span> foo<span class="token operator">:</span> <span class="token string">'foo'</span> <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span>  <span class="token comment">// works</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">let</span> bar<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token operator">=</span> <span class="token function">identity</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Error</span>
</code></pre></div><p>泛型允许你在添加约束时保留更具体的类型。通过这种方式，泛型上的类型充当“边界”。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> identity<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">:</span> string<span class="token operator">&gt;</span><span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> val<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> foo<span class="token operator">:</span> <span class="token string">'foo'</span> <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span>           <span class="token comment">// Works!</span>
<span class="token keyword">let</span> bar<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token operator">=</span> <span class="token function">identity</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Works!</span>
</code></pre></div><p>请注意，如果你具有绑定泛型类型的值，则不能将其用作更具体的类型</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> identity<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">:</span> string<span class="token operator">&gt;</span><span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> str<span class="token operator">:</span> string <span class="token operator">=</span> val<span class="token punctuation">;</span> <span class="token comment">// Works!</span>
  <span class="token comment">// $ExpectError</span>
  <span class="token keyword">let</span> bar<span class="token operator">:</span> <span class="token string">'bar'</span>  <span class="token operator">=</span> val<span class="token punctuation">;</span> <span class="token comment">// Error!</span>
  <span class="token keyword">return</span> val<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">identity</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="参数化泛型">参数化泛型</h4> <p>泛型有时允许您将类似参数的类型传递给函数。这些被称为参数化泛型（或参数多态）。
例如，参数化具有泛型的类型别名。当你去使用它时，你必须提供一个类型参数。</p> <div class="language-js extra-class"><pre class="language-js"><code>type Item<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  prop<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> item<span class="token operator">:</span> Item<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  prop<span class="token operator">:</span> <span class="token string">&quot;value&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>您可以将此视为将函数传递给函数，只有返回值是您可以使用的类型。
类（当用作类型时），类型别名和接口都要求您传递类型参数。函数和函数类型没有参数化泛型。
<strong>classes</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">class</span> <span class="token class-name">Item</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  prop<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">param<span class="token operator">:</span> <span class="token constant">T</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>prop <span class="token operator">=</span> param<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> item1<span class="token operator">:</span> Item<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Item</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Works!</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">let</span> item2<span class="token operator">:</span> Item <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Item</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error!</span>
</code></pre></div><h4 id="type-aliases-类型别名">Type Aliases 类型别名</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
type Item<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  prop<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> item1<span class="token operator">:</span> Item<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span> prop<span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Works!</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">let</span> item2<span class="token operator">:</span> Item <span class="token operator">=</span> <span class="token punctuation">{</span> prop<span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Error!</span>
</code></pre></div><h4 id="接口">接口</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">interface</span> <span class="token class-name">HasProp</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  prop<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Item</span> <span class="token punctuation">{</span>
  prop<span class="token operator">:</span> string<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">(</span><span class="token class-name">Item</span><span class="token punctuation">.</span>prototype<span class="token operator">:</span> HasProp<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Works!</span>
<span class="token comment">// $ExpectError</span>
<span class="token punctuation">(</span><span class="token class-name">Item</span><span class="token punctuation">.</span>prototype<span class="token operator">:</span> HasProp<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error!</span>
</code></pre></div><h4 id="添加参数化泛型的默认值">添加参数化泛型的默认值</h4> <p>你还可以像函数一样为参数化泛型提供默认值</p> <div class="language-js extra-class"><pre class="language-js"><code>type Item<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">:</span> number <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  prop<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> foo<span class="token operator">:</span> Item<span class="token operator">&lt;</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span> prop<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> bar<span class="token operator">:</span> Item<span class="token operator">&lt;</span><span class="token number">2</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span> prop<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>使用类型时，必须始终包括括号<code>&lt;&gt;</code>（就像函数调用的括号一样）。</p> <h3 id="联合类型">联合类型</h3> <p>有时，创建一个其他类型之一的类型很有用。例如，你可能希望编写一个接受一组原始值类型的函数。对于此Flow支持联合类型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">toStringPrimitives</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> number <span class="token operator">|</span> boolean <span class="token operator">|</span> string</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">String</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">toStringPrimitives</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token function">toStringPrimitives</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token function">toStringPrimitives</span><span class="token punctuation">(</span><span class="token string">'three'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token comment">// $ExpectError</span>
<span class="token function">toStringPrimitives</span><span class="token punctuation">(</span><span class="token punctuation">{</span>prop<span class="token operator">:</span> <span class="token string">'val'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Error</span>
<span class="token function">toStringPrimitives</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Error</span>
</code></pre></div><h4 id="语法">语法</h4> <p>联合类型是任意数量的类型，由|连接</p> <div class="language-js extra-class"><pre class="language-js"><code>Type1 <span class="token operator">|</span> Type2 <span class="token operator">|</span> <span class="token operator">...</span> <span class="token operator">|</span> TypeN
</code></pre></div><p>您还可以添加一个引导竖线，这在将联合类型拆分到多行时非常有用。</p> <div class="language-js extra-class"><pre class="language-js"><code>type Foo <span class="token operator">=</span>
  <span class="token operator">|</span> Type1
  <span class="token operator">|</span> Type2
  <span class="token operator">|</span> <span class="token operator">...</span>
  <span class="token operator">|</span> TypeN
</code></pre></div><p>联合类型的每个成员可以是任何类型，甚至可以是另一个联合类型</p> <div class="language-js extra-class"><pre class="language-js"><code>type Numbers <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">2</span><span class="token punctuation">;</span>
type Colors <span class="token operator">=</span> <span class="token string">'red'</span> <span class="token operator">|</span> <span class="token string">'blue'</span>
type Fish <span class="token operator">=</span> Numbers <span class="token operator">|</span> Colors<span class="token punctuation">;</span>
</code></pre></div><h4 id="联合类型需要一个输入，但全部输出">联合类型需要一个输入，但全部输出</h4> <p>在调用接受联合类型的函数时，必须传入其中一种类型。但是在函数内部，我们需要处理所有可能的类型。
让我们重写函数，分别处理每种类型</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">function</span> <span class="token function">toStringPrimitives</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> number <span class="token operator">|</span> boolean <span class="token operator">|</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span> <span class="token comment">// Error!</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">'number'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">String</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">'boolean'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">String</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>您会注意到，如果我们不处理值的每种可能类型，Flow将给我们一个错误。</p> <h4 id="联合-细化">联合 &amp; 细化</h4> <p>当您有一个联合类型的值时，将其分开并分别处理每个单独的类型通常是很有用的。使用流中的联合类型，您可以将值“细化”为单个类型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">toStringPrimitives</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> number <span class="token operator">|</span> boolean <span class="token operator">|</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">'number'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> maximumSignificantDigits<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Works!</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>通过检查值的类型并测试它是否是一个数字，Flow知道在该块内部它只是一个数字。然后，我们可以编写代码，将我们的值视为该块内的一个数字。</p> <h4 id="不相交联合">不相交联合</h4> <p>在flow中有一种特殊类型的联合，称为“不相交联合”，可用于改进。这些不相交的联合由任意数量的对象类型组成，每个对象类型都由一个属性标记。
例如，假设我们有一个函数，用于在发送请求后处理来自服务器的响应。当请求成功时，我们将返回一个具有成功属性的对象，该属性是true和我们已经更新的值。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>value<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span>
</code></pre></div><p>当请求失败时，我们将获得一个成功设置为false的对象和一个描述错误的Error属性</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>error<span class="token operator">:</span> <span class="token string">'Bad request'</span><span class="token punctuation">}</span>
</code></pre></div><p>我们可以尝试用一个对象类型来表示这两个对象。但是，我们很快就会遇到这样的问题：我们根据Success属性知道一个属性存在，但Flow不知道</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
type Response <span class="token operator">=</span> <span class="token punctuation">{</span>
  success<span class="token operator">:</span> boolean<span class="token punctuation">,</span>
  value<span class="token operator">?</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span>
  error<span class="token operator">?</span><span class="token operator">:</span> string
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">handleResponse</span><span class="token punctuation">(</span><span class="token parameter">response<span class="token operator">:</span> Response</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>success<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// $ExpectError</span>
    <span class="token keyword">var</span> value<span class="token operator">:</span> boolean <span class="token operator">=</span> response<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// Error</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token comment">// $ExpectError</span>
    <span class="token keyword">var</span> error<span class="token operator">:</span> string <span class="token operator">=</span> response<span class="token punctuation">.</span>error<span class="token punctuation">;</span>  <span class="token comment">// Error</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>试图把这两种不同的类型合并成一种，只会给我们带来麻烦
相反，如果我们创建这两种对象类型的联合类型，Flow将能够根据Success属性知道我们使用的是哪个对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
type Success <span class="token operator">=</span> <span class="token punctuation">{</span>success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>value<span class="token operator">:</span> boolean<span class="token punctuation">}</span><span class="token punctuation">;</span>
type Failed <span class="token operator">=</span> <span class="token punctuation">{</span>success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>error<span class="token operator">:</span> string<span class="token punctuation">}</span><span class="token punctuation">;</span>
type Response <span class="token operator">=</span> Success <span class="token operator">|</span> Failed<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">handleResponse</span><span class="token punctuation">(</span><span class="token parameter">response<span class="token operator">:</span> Response</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>success<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> value<span class="token operator">:</span> boolean <span class="token operator">=</span> response<span class="token punctuation">.</span>value<span class="token punctuation">;</span>   <span class="token comment">// works</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> error<span class="token operator">:</span> string <span class="token operator">=</span> response<span class="token punctuation">.</span>error<span class="token punctuation">;</span>   <span class="token comment">// works</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="精确的不相交联合">精确的不相交联合</h4> <p>不相交的联合要求你使用单个属性来区分每种对象类型。不能通过不同的属性区分两个不同的对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
type Success <span class="token operator">=</span> <span class="token punctuation">{</span>success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token operator">:</span> boolean<span class="token punctuation">}</span><span class="token punctuation">;</span>
type Failed <span class="token operator">=</span> <span class="token punctuation">{</span>error<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>massage<span class="token operator">:</span> string<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">handleResponse</span><span class="token punctuation">(</span><span class="token parameter">response<span class="token operator">:</span> Success <span class="token operator">|</span> Failed</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>success<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> value<span class="token operator">:</span> boolean <span class="token operator">=</span> response<span class="token punctuation">.</span>value  <span class="token comment">// Error</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这是因为在Flow中传递一个属性比对象类型期望的属性多的对象值是可以的（因为宽度子类型）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
type Success <span class="token operator">=</span> <span class="token punctuation">{</span>success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>value<span class="token operator">:</span> boolean<span class="token punctuation">}</span><span class="token punctuation">;</span>
type Failed <span class="token operator">=</span> <span class="token punctuation">{</span>error<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>message<span class="token operator">:</span> string<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">handleResponse</span><span class="token punctuation">(</span><span class="token parameter">response<span class="token operator">:</span> Success <span class="token operator">|</span> Failed</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token function">handleResponse</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  error<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  value<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  message<span class="token operator">:</span> <span class="token string">'hi'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>除非这些物体在某种程度上相互冲突，否则就没办法区分它们。
但是，要解决这个问题，你可以使用精确的对象类型</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
type Success <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">|</span> success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>value<span class="token operator">:</span> boolean <span class="token operator">|</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
type Failed <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">|</span> error<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> message<span class="token operator">:</span> string <span class="token operator">|</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
type Response <span class="token operator">=</span> Success <span class="token operator">|</span> Failed<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">handleResponse</span><span class="token punctuation">(</span><span class="token parameter">response<span class="token operator">:</span> Response</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>success<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> value<span class="token operator">:</span> boolean <span class="token operator">=</span> response<span class="token punctuation">.</span>value
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> message<span class="token operator">:</span> string <span class="token operator">=</span> response<span class="token punctuation">.</span>message
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>有了精确的对象类型，我们就不可能有额外的属性，所以对象之间会发生冲突，我们就能区分出哪个是哪个</p> <h3 id="相交类型">相交类型</h3> <p>有时候，创建一个类型（它是一组其他类型的集合）是很有用的。例如，你可能希望编写一个接受对象的函数，该对象时其他对象类型的组合。
为此，Flow支持交集类型</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
type <span class="token constant">A</span> <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> number<span class="token punctuation">}</span><span class="token punctuation">;</span>
type <span class="token constant">B</span> <span class="token operator">=</span> <span class="token punctuation">{</span>b<span class="token operator">:</span> boolean<span class="token punctuation">}</span><span class="token punctuation">;</span>
type <span class="token constant">C</span> <span class="token operator">=</span> <span class="token punctuation">{</span>c<span class="token operator">:</span> string<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> <span class="token constant">A</span> <span class="token operator">&amp;</span> <span class="token constant">B</span> <span class="token operator">&amp;</span> <span class="token constant">C</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token comment">// $ExpectError</span>
<span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Error</span>
<span class="token comment">// $ExpectError</span>
<span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>b<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Error</span>
<span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>b<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token string">'three'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
</code></pre></div><h4 id="相交类型语法">相交类型语法</h4> <p>交集类型是任意数量的类型，这些类型是由&amp;号连接的</p> <div class="language-js extra-class"><pre class="language-js"><code>Type1 <span class="token operator">&amp;</span> Type2 <span class="token operator">&amp;</span> <span class="token operator">...</span> <span class="token operator">&amp;</span> TypeN
</code></pre></div><p>交集类型的每个成员可以是任何类型，甚至是另一个交集类型</p> <div class="language-js extra-class"><pre class="language-js"><code>type Foo <span class="token operator">=</span> Type1 <span class="token operator">&amp;</span> Type2<span class="token punctuation">;</span>
type Bar <span class="token operator">=</span> Type3 <span class="token operator">&amp;</span> Type4<span class="token punctuation">;</span>
type Baz <span class="token operator">=</span> Foo <span class="token operator">&amp;</span> Bar
</code></pre></div><p><strong>交集类型需要全部输入，但只需要一个输出</strong>
交集类型与并集类型相反。当调用接受交集类型的函数时，我们必须传入所有这些类型。但是在我们的函数内部，我们只需要把它当做这些类型中的任何一种。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
type <span class="token constant">A</span> <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> number<span class="token punctuation">}</span><span class="token punctuation">;</span>
type <span class="token constant">B</span> <span class="token operator">=</span> <span class="token punctuation">{</span>b<span class="token operator">:</span> boolean<span class="token punctuation">}</span><span class="token punctuation">;</span>
type <span class="token constant">C</span> <span class="token operator">=</span> <span class="token punctuation">{</span>c<span class="token operator">:</span> string<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> <span class="token constant">A</span> <span class="token operator">&amp;</span> <span class="token constant">B</span> <span class="token operator">&amp;</span> <span class="token constant">C</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> a<span class="token operator">:</span> <span class="token constant">A</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token keyword">var</span> b<span class="token operator">:</span> <span class="token constant">B</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token keyword">var</span> c<span class="token operator">:</span> <span class="token constant">C</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>即使我们只将值视为其中的一种类型，我们也不会得到一个错误，因为它满足了所有类型</p> <h4 id="不可能相交类型">不可能相交类型</h4> <p>使用相交类型，可以创建在运行时无法创建的类型。交集类型允许你组合任何类型集，即使是那些相互冲突的类型。
例如，可以创建数字和字符串的相交类型</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
type NumberAndString <span class="token operator">=</span> number <span class="token operator">&amp;</span> string
<span class="token keyword">function</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> NumberAndString</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token comment">// $ExpectError</span>
<span class="token function">method</span><span class="token punctuation">(</span><span class="token number">3.14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Error</span>
<span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'hi'</span><span class="token punctuation">)</span>    <span class="token comment">// Error</span>
</code></pre></div><p>但是你不可能同时创建一个数字和一个字符串的值，但是你可以为它创建一个类型。创建这样的类型没有实际的用途，但是它是交集类型工作方式的副作用</p> <h4 id="对象相交类型">对象相交类型</h4> <p>创建对象相交类型时，可以将它们的所有属性合并在一起
例如，当你创建具有不同属性集的两个对象的交集时，它将导致具有所有属性的对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
type One <span class="token operator">=</span> <span class="token punctuation">{</span>foo<span class="token operator">:</span> number<span class="token punctuation">}</span><span class="token punctuation">;</span>
type Two <span class="token operator">=</span> <span class="token punctuation">{</span>bar<span class="token operator">:</span> boolean<span class="token punctuation">}</span><span class="token punctuation">;</span>
type Both <span class="token operator">=</span> One <span class="token operator">&amp;</span> Two
<span class="token keyword">var</span> value<span class="token operator">:</span> Both <span class="token operator">=</span> <span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  bar<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><p>但是，当你的属性通过具有相同的名称而重叠时，它也会创建属性类型的交集
例如，如果将两个对象与名为prop的属性合并，其中一个对象的类型为Number，另一个对象的类型为布尔，则得到的对象将具有数字和布尔值的交集</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
type One <span class="token operator">=</span> <span class="token punctuation">{</span>prop<span class="token operator">:</span> number<span class="token punctuation">}</span><span class="token punctuation">;</span>
type Two <span class="token operator">=</span> <span class="token punctuation">{</span>prop<span class="token operator">:</span> boolean<span class="token punctuation">}</span><span class="token punctuation">;</span>
type Both <span class="token operator">=</span> One <span class="token operator">&amp;</span> Two
<span class="token comment">// $ExpectError</span>
<span class="token keyword">var</span> value<span class="token operator">:</span> Both <span class="token operator">=</span> <span class="token punctuation">{</span>
  prop<span class="token operator">:</span> <span class="token number">1</span>   <span class="token comment">// Error</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="获取类型的类型">获取类型的类型</h4> <p>JavaScript有一个TypeOf操作符，它返回一个描述值的字符串</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">typeof</span> <span class="token number">1</span> <span class="token operator">===</span> <span class="token string">'number'</span>
<span class="token keyword">typeof</span> <span class="token boolean">true</span> <span class="token operator">===</span> <span class="token string">'boolean'</span>
<span class="token keyword">typeof</span> <span class="token string">'three'</span> <span class="token operator">===</span> <span class="token string">'string'</span>
</code></pre></div><p>但是，由于这个字符串只描述了关于类型的太多内容，所以它是有限的</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">typeof</span> <span class="token punctuation">{</span>foo<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span> <span class="token operator">===</span> <span class="token string">'object'</span>
<span class="token keyword">typeof</span> <span class="token punctuation">{</span>bar<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span> <span class="token operator">===</span> <span class="token string">'object'</span>
<span class="token keyword">typeof</span> <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'object'</span>
</code></pre></div><p>在Flow中，有一个类似类型的操作符，但它的功能要强大得多。ss</p> <h4 id="获取类型语法">获取类型语法</h4> <p>TypeOf运算符返回给定值的流类型，以用作类型</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">let</span> num1 <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> num2<span class="token operator">:</span> <span class="token keyword">typeof</span> num1 <span class="token operator">=</span> <span class="token number">3.14</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">let</span> num3<span class="token operator">:</span> <span class="token keyword">typeof</span> num1 <span class="token operator">=</span> <span class="token string">'world'</span><span class="token punctuation">;</span>    <span class="token comment">// Error</span>
<span class="token keyword">let</span> bool1 <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token keyword">let</span> bool2<span class="token operator">:</span> <span class="token keyword">typeof</span> bool1 <span class="token operator">=</span> <span class="token boolean">false</span>  <span class="token comment">// works</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">let</span> bool3<span class="token operator">:</span> <span class="token keyword">typeof</span> bool1 <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>   <span class="token comment">// Error</span>
<span class="token keyword">let</span> str1 <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> str2<span class="token operator">:</span> <span class="token keyword">typeof</span> str1 <span class="token operator">=</span> <span class="token string">'world'</span><span class="token punctuation">;</span> <span class="token comment">// works</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">let</span> str3<span class="token operator">:</span> <span class="token keyword">typeof</span> str1 <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>   <span class="token comment">// Error</span>
</code></pre></div><p>你可以在Typeof中使用任何值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">let</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>foo<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>bar<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>baz<span class="token operator">:</span> <span class="token string">'three'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> obj2<span class="token operator">:</span> <span class="token keyword">typeof</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>foo<span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">,</span>bar<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>baz<span class="token operator">:</span> <span class="token string">'hello'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> arr2<span class="token operator">:</span> <span class="token keyword">typeof</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>
</code></pre></div><h4 id="类型继承-推理行为">类型继承-推理行为</h4> <p>Flow对你的代码执行各种类型推断，因此你不必键入任何注释。一般情况下，推理会避免妨碍你的方法，同时也会阻止你引入bug
但是，当你使用typeof时，你是在获取Flow的推断结果，并将其断言为一个类型。虽然这可能非常有用，但也可能导致一些意向不到的结果
例如，当你在流中使用文本值时，它们推断的类型就是它所属的基元。因此，数字42具有推断出的数字类型。使用typeof时可以看到这一点</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">let</span> num1 <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> num2<span class="token operator">:</span> <span class="token keyword">typeof</span> num1 <span class="token operator">=</span> <span class="token number">3.14</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token keyword">let</span> bool1 <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token keyword">let</span> bool2<span class="token operator">:</span> <span class="token keyword">typeof</span> bool1 <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token keyword">let</span> str1 <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> str2<span class="token operator">:</span> <span class="token keyword">typeof</span> str1 <span class="token operator">=</span> <span class="token string">'world'</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
</code></pre></div><p>但是，这只发生在推断的类型中。如果指定文字类型，则将在typeof中使用它</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">let</span> num1<span class="token operator">:</span> <span class="token number">42</span> <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">let</span> num2<span class="token operator">:</span> <span class="token keyword">typeof</span> num1 <span class="token operator">=</span> <span class="token number">3.14</span><span class="token punctuation">;</span>   <span class="token comment">// Error</span>
<span class="token keyword">let</span> bool1<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">let</span> bool2<span class="token operator">:</span> <span class="token keyword">typeof</span> bool1 <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token comment">// Error</span>
<span class="token keyword">let</span> str1<span class="token operator">:</span> <span class="token string">'hello'</span> <span class="token operator">=</span> <span class="token string">'hello'</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">let</span> str2<span class="token operator">:</span> <span class="token keyword">typeof</span> str1 <span class="token operator">=</span> <span class="token string">'world'</span><span class="token punctuation">;</span>   <span class="token comment">// Error</span>
</code></pre></div><h4 id="类型继承其他类型的行为">类型继承其他类型的行为</h4> <p>flow中有许多不同的类型，其中一些类型的行为与其他类型不同。这些差异对该特定类型是有意义的，但对其他类型则没有意义
当你使用typeof时，你插入的是另一个类型及其所有行为。这可以使类型看起来不一致的地方，它不是
例如，如果在类中使用typeof，则需要记住类名义上是类型化的，而不是结构类型化的。因此，两个具有相同确切形状的类不被认为是等价的。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
  <span class="token function">method</span><span class="token punctuation">(</span><span class="token parameter">val<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">YourClass</span> <span class="token punctuation">{</span>
  <span class="token function">method</span><span class="token punctuation">(</span><span class="token parameter">val<span class="token operator">:</span> number</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// $ExpectError</span>
<span class="token keyword">let</span> test1<span class="token operator">:</span> <span class="token keyword">typeof</span> MyClass <span class="token operator">=</span> YourClass<span class="token punctuation">;</span>   <span class="token comment">// Error</span>
<span class="token keyword">let</span> test2<span class="token operator">:</span> <span class="token keyword">typeof</span> MyClass <span class="token operator">=</span> MyClass<span class="token punctuation">;</span>  <span class="token comment">// works</span>
</code></pre></div><h3 id="类型转换表达式">类型转换表达式</h3> <p>有时候，断言类型而不用函数或变量这样做是有用的。对于这个flow，它支持内联类型转换表达式语法，可以多种不同的方式使用它</p> <h4 id="类型转换表达式语法">类型转换表达式语法</h4> <p>为了围绕值创建类型转换表达式，添加一个冒号：withtheType,并用圆括号()包装表达式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span>value<span class="token operator">:</span> Type<span class="token punctuation">)</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>注意： 括号是必要的，以避免与其他语法的歧义</p></div> <p>类型转换表达式可以出现在表达式可以出现的任何地方</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> val <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> Type<span class="token punctuation">)</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>prop<span class="token operator">:</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> Type<span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span>value<span class="token operator">:</span> Type<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>value<span class="token operator">:</span> Type<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>Type<span class="token operator">&gt;</span><span class="token punctuation">)</span>
</code></pre></div><p>值本身也可以是表达式：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">:</span> number<span class="token punctuation">)</span>
</code></pre></div><p>当你剥离类型时，只剩下值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span>value<span class="token operator">:</span> Type<span class="token punctuation">)</span><span class="token punctuation">;</span>
value
</code></pre></div><h4 id="类型断言">类型断言</h4> <p>使用类型转换表达式，你可以断言值时某些类型</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token punctuation">(</span>value<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token punctuation">(</span>value<span class="token operator">:</span> string<span class="token punctuation">)</span>   <span class="token comment">// Error</span>
</code></pre></div><p>以这种方式断言类型的工作方式与其他任何地方的类型相同</p> <h4 id="铸造类型">铸造类型</h4> <p>当你编写类型转换表达式时，该表达式的结果是具有所提供类型的值。如果你持有结果值，则它将具有新类型</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token punctuation">(</span>value<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// works</span>
<span class="token keyword">let</span> newValue <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> number<span class="token punctuation">)</span>
<span class="token comment">// $ExpectError</span>
<span class="token punctuation">(</span>newValue<span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Error</span>
<span class="token punctuation">(</span>newValue<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
</code></pre></div><h4 id="使用类型转换表达式">使用类型转换表达式</h4> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>注意：我们将通过一个简单的示例来演示如何使用类型转换表达式。这个例子在实践中没有得到很好的解决</p></div> <h4 id="类型铸造">类型铸造</h4> <p>因为类型强制转换与所有其他类型注释的工作方式相同，所以只能将值强制转换为不太特定的类型。你不能更改类型或使其更具体
但是你可以使用任何类型的转换来转换为你想要的任何类型</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span>value<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// works</span>
<span class="token comment">// $ExpectError</span>
<span class="token punctuation">(</span>value<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Error</span>
<span class="token keyword">let</span> newValue <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>value<span class="token operator">:</span> any<span class="token punctuation">)</span><span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// $ExpectError</span>
<span class="token punctuation">(</span>newValue<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Error</span>
<span class="token punctuation">(</span>newValue<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// works</span>
</code></pre></div><p>通过将值强制转换为任何值，然后可以将其转换为任何你想要的值
这是不安全的，不推荐使用。但是，当你使用一个很难或不可能键入的值并希望确保结果具有所需的类型时，它有时是有用的
例如，下面的函数用于克隆对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">cloneObject</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> clone <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    clone<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> clone
<span class="token punctuation">}</span>
</code></pre></div><p>要为此创建一个类型是很困难的，因为我们正在基于另一个对象创建一个新对象。
如果我们对任何类型进行强制转换，则可以返回一个更有用的类型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">cloneObject</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> clone <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    clone<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>clone<span class="token operator">:</span> any<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">typeof</span> obj<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> clone <span class="token operator">=</span> <span class="token function">cloneObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  bar<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  baz<span class="token operator">:</span> <span class="token string">'three'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span>clone<span class="token punctuation">.</span>foo<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// works</span>
<span class="token punctuation">(</span>clone<span class="token punctuation">.</span>bar<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token punctuation">(</span>clone<span class="token punctuation">.</span>baz<span class="token operator">:</span> <span class="token string">'three'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
</code></pre></div><h4 id="通过类型断言进行类型检查">通过类型断言进行类型检查</h4> <p>如果我们想要验证来自之前的cloneObject方法中的类型，我们可以编写以下注释</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">cloneObject</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">[</span>key<span class="token operator">:</span> string<span class="token punctuation">]</span><span class="token operator">:</span> mixed<span class="token punctuation">}</span></span><span class="token punctuation">)</span>
</code></pre></div><p>但现在我们有麻烦了。我们的TypeOfobj注释也得到了这个新注释，它破坏了整个目的</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">cloneObject</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">[</span>key<span class="token operator">:</span> string<span class="token punctuation">]</span><span class="token operator">:</span> mixed<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> clone <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>clone<span class="token operator">:</span> any<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">typeof</span> obj<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> clone <span class="token operator">=</span> <span class="token function">cloneObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  bar<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  baz<span class="token operator">:</span> <span class="token string">'three'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// $ExpectError</span>
<span class="token punctuation">(</span>clone<span class="token punctuation">.</span>foo<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// Error</span>
<span class="token comment">// $ExpectError</span>
<span class="token punctuation">(</span>clone<span class="token punctuation">.</span>bar<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Error</span>
<span class="token comment">// $ExpectError</span>
<span class="token punctuation">(</span>clone<span class="token punctuation">.</span>baz<span class="token operator">:</span> <span class="token string">'three'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Error</span>
</code></pre></div><p>相反，我们可以使用类型断言来判断函数中的类型，现在我们正在验证我们的输入</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">cloneObject</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token punctuation">(</span>obj<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">[</span>key<span class="token operator">:</span> string<span class="token punctuation">]</span><span class="token operator">:</span> mixed<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">cloneObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>foo<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// works</span>
<span class="token comment">// $ExpectError</span>
<span class="token function">cloneObject</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>   <span class="token comment">// Error</span>
</code></pre></div><p>现在，类型推断可以继续为Typeofobj工作，它返回对象的预期形状</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @flow</span>
<span class="token keyword">function</span> <span class="token function">cloneObject</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">(</span>obj<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>key<span class="token operator">:</span> string<span class="token punctuation">]</span><span class="token operator">:</span> mixed <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;&lt;</span>
  <span class="token keyword">const</span> clone <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>clone<span class="token operator">:</span> any<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">typeof</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> clone <span class="token operator">=</span> <span class="token function">cloneObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  bar<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  baz<span class="token operator">:</span> <span class="token string">'three'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span>clone<span class="token punctuation">.</span>foo<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// Works!</span>
<span class="token punctuation">(</span>clone<span class="token punctuation">.</span>bar<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// Works!</span>
<span class="token punctuation">(</span>clone<span class="token punctuation">.</span>baz<span class="token operator">:</span> <span class="token string">'three'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Works!</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>注：这不是解决上述问题的正确方法，仅用于演示。正确的解决方案是注释该函数，如下所示：</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> cloneObject<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">[</span>key<span class="token operator">:</span> string<span class="token punctuation">]</span><span class="token operator">:</span> mixed<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>obj<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> $Shape<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/indexedDB/" class="prev">
        indexedDB
      </a></span> <span class="next"><a href="/webpack/">
        webpack
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a8c572bd.js" defer></script><script src="/assets/js/2.8ad555b3.js" defer></script><script src="/assets/js/23.591b0146.js" defer></script>
  </body>
</html>
